# SubMux Omni Pro v3.0

<div align="center">

**作者：LYP** | [GitHub](https://github.com/lyp0746) | [邮箱](mailto:1610369302@qq.com)

![Python](https://img.shields.io/badge/Python-3.7+-blue.svg)
![PyQt5](https://img.shields.io/badge/PyQt5-5.15+-green.svg)
![FFmpeg](https://img.shields.io/badge/FFmpeg-Required-red.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)
![Platform](https://img.shields.io/badge/Platform-Windows%20%7C%20macOS%20%7C%20Linux-lightgrey.svg)

**功能强大的 FFmpeg 图形化全能工具箱**

[功能特性](#功能特性) • [快速开始](#快速开始) • [使用指南](#使用指南) • [常见问题](#常见问题) • [更新日志](#更新日志)

</div>

---

## 📖 简介

SubMux Omni Pro 是一款基于 **FFmpeg** 的专业视频处理工具，提供现代化的图形界面，让复杂的视频处理操作变得简单直观。无论是日常视频编辑、格式转换，还是批量处理任务，都能轻松完成。

### 为什么选择 SubMux Omni Pro？

- 🎯 **功能全面**：集成 20+ 常用视频处理功能，一站式解决方案
- 🚀 **简单易用**：图形化界面，无需记忆复杂的 FFmpeg 命令
- ⚡ **高效批处理**：支持任务队列，批量处理数百个文件
- 🎨 **界面现代**：基于 PyQt5，提供深色/浅色主题切换
- 📊 **实时反馈**：实时进度显示，任务状态一目了然
- 💾 **历史记录**：完整的任务历史，方便追溯和复查

---

## ✨ 功能特性

### 🎬 视频处理（13 项功能）

| 功能 | 说明 | 应用场景 |
|------|------|----------|
| **字幕封装** | 外挂字幕封装为 MKV（极速无损） | 视频添加多语言字幕 |
| **字幕烧录** | 永久烧录字幕到画面（MP4） | 兼容不支持外挂字幕的设备 |
| **音画合并** | 合并独立的视频流和音频流 | YouTube 分离文件合并 |
| **视频拼接** | 多个视频无缝拼接为一个 | 合并分段视频 |
| **格式转换** | 转换 MP4/MKV/AVI/MOV 等格式 | 适配不同播放设备 |
| **精确剪辑** | 按时间点剪辑视频片段 | 提取精彩片段 |
| **智能压缩** | H.264/H.265 高质量压缩 | 减小文件体积，节省空间 |
| **修改分辨率** | 缩放视频尺寸（720p/1080p/4K） | 适配不同屏幕分辨率 |
| **画面裁剪** | 裁剪视频去除黑边或提取区域 | 调整画面比例 |
| **旋转翻转** | 90°/180°/270° 旋转，水平/垂直翻转 | 修正拍摄方向 |
| **GIF 导出** | 视频转 GIF 动图 | 制作表情包、动态展示 |
| **视频倒放** | 时间倒序播放效果 | 创意视频制作 |
| **视频防抖** | 稳定手持拍摄的抖动画面 | 提升观看体验 |

### 🎨 画面增强（4 项功能）

| 功能 | 说明 | 应用场景 |
|------|------|----------|
| **文字水印** | 添加自定义文字水印 | 版权保护、品牌标识 |
| **色彩调节** | 调整亮度/对比度/饱和度 | 改善画面观感 |
| **视频降噪** | 去除画面噪点 | 提升低光环境拍摄质量 |
| **变速播放** | 0.25x-4x 倍速调节 | 慢动作、快进效果 |

### 🎵 音频处理（4 项功能）

| 功能 | 说明 | 应用场景 |
|------|------|----------|
| **替换音频** | 更换视频背景音乐 | 视频配乐替换 |
| **音量调节** | 增大或减小音量（±20dB） | 统一音量大小 |
| **提取音频** | 导出 MP3/AAC/WAV/FLAC | 提取音乐、音效 |
| **提取字幕** | 导出内嵌字幕轨道 | 获取字幕文件 |

### 🛡️ 实用工具（2 项功能）

| 功能 | 说明 | 应用场景 |
|------|------|----------|
| **提取截图** | 指定时间点截图（JPG/PNG） | 制作封面、预览图 |
| **清除元数据** | 清除 GPS、拍摄设备等隐私信息 | 保护个人隐私 |

---

## 🚀 快速开始

### 📋 系统要求

- **操作系统**：Windows 10/11、macOS 10.14+、Linux（Ubuntu 18.04+）
- **Python**：3.7 或更高版本
- **FFmpeg**：必须安装并配置环境变量

### 📦 安装步骤

#### 1. 安装 Python

访问 [Python 官网](https://www.python.org/downloads/) 下载安装最新版本。

**验证安装**：
```bash
python --version
```

#### 2. 安装 FFmpeg

##### Windows
1. 访问 [FFmpeg 官网](https://ffmpeg.org/download.html) 或 [gyan.dev](https://www.gyan.dev/ffmpeg/builds/)
2. 下载 `ffmpeg-release-essentials.zip`
3. 解压到 `C:\ffmpeg`
4. 将 `C:\ffmpeg\bin` 添加到系统环境变量 PATH

**验证安装**：
```cmd
ffmpeg -version
```

##### macOS
使用 Homebrew 安装：
```bash
brew install ffmpeg
```

##### Linux (Ubuntu/Debian)
```bash
sudo apt update
sudo apt install ffmpeg
```

#### 3. 安装依赖库

```bash
pip install PyQt5
```

或使用 requirements.txt：
```bash
pip install -r requirements.txt
```

**requirements.txt 内容**：
```
PyQt5>=5.15.0
```

#### 4. 运行程序

```bash
python SubMuxOmniPro.py
```

### 🎉 首次使用

1. 启动程序后，点击 **"🔍 检测 FFmpeg"** 确认环境正常
2. 选择功能类型（如"软字幕封装"）
3. 选择视频文件和字幕文件
4. 点击 **"🚀 立即执行"** 或 **"➕ 添加到队列"**
5. 等待处理完成，输出文件保存在原视频同目录

---

## 📚 使用指南

### 🎯 界面布局

```
┌─────────────────────────────────────────────────────────┐
│  SubMux Omni Pro v3.0                   [检测] [主题] [?]│
├─────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────┐  │
│  │ 🛠️全能工具箱 | 📋任务队列 | 📜历史记录 | ⚙️设置  │  │
│  ├───────────────────────────────────────────────────┤  │
│  │ 1️⃣ 功能选择                                      │  │
│  │   [📄 软字幕封装 (MKV无损) ▼]                    │  │
│  │                                                   │  │
│  │ 2️⃣ 参数设置                                      │  │
│  │   [动态参数区域]                                  │  │
│  │                                                   │  │
│  │ 3️⃣ 文件来源                                      │  │
│  │   ○ 单文件处理  ○ 批量处理/拼接                   │  │
│  │   视频文件: [________________] [浏览...]          │  │
│  │   字幕文件: [________________] [浏览...][智能匹配]│  │
│  │                                                   │  │
│  │   [➕ 添加到队列]  [🚀 立即执行]  [⏹️ 停止]      │  │
│  └───────────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────┤
│  📝 系统日志                                            │
│  ┌───────────────────────────────────────────────────┐  │
│  │ [10:30:15] ✓ FFmpeg 检测成功                      │  │
│  │ [10:30:20] 🎬 开始处理: video.mp4                 │  │
│  │ [10:30:25] ✓ 任务成功完成                         │  │
│  └───────────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────┤
│  就绪                                   进度: ████ 45%  │
└─────────────────────────────────────────────────────────┘
```

### 🎬 典型使用场景

#### 场景1：为视频添加字幕

1. **功能选择**：选择 **"📄 软字幕封装 (MKV无损)"**
2. **选择文件**：
   - 视频文件：`movie.mp4`
   - 字幕文件：`movie.srt` 或点击 **"🔍 智能匹配"** 自动查找
3. **执行**：点击 **"🚀 立即执行"**
4. **输出**：生成 `movie_merged.mkv`（保留原视频质量，速度极快）

> 💡 **提示**：软字幕可以在播放器中自由开关，推荐使用 MKV 格式。

#### 场景2：压缩视频减小体积

1. **功能选择**：选择 **"📉 视频压缩 (H.264/H.265)"**
2. **参数设置**：
   - 编码器：`libx265 (H.265)` - 压缩率更高
   - CRF 画质：`28` - 中等压缩（数值越大体积越小）
   - 编码预设：`medium` - 平衡速度和质量
3. **选择文件**：选择要压缩的视频
4. **执行**：点击 **"🚀 立即执行"**
5. **输出**：生成 `video_compressed.mp4`（体积减小 50-70%）

> ⚠️ **注意**：CRF 值建议范围
> - `18-23`：高质量（轻微压缩）
> - `23-28`：标准质量（推荐）
> - `28-35`：低质量（高度压缩）

#### 场景3：批量处理多个视频

1. **文件模式**：选择 **"批量处理/拼接"**
2. **选择文件夹**：选择包含视频的文件夹
3. **文件格式**：输入 `mp4, mkv, mov`
4. **选择功能**：如 **"🔄 格式转换 (MP4/MKV/AVI)"**
5. **添加到队列**：点击 **"➕ 添加到队列"**
6. **开始队列**：切换到 **"📋 任务队列"** 标签，点击 **"▶️ 开始队列"**
7. **自动处理**：程序会依次处理所有文件

#### 场景4：视频拼接合并

1. **功能选择**：选择 **"🔗 视频拼接 (多合一)"**
2. **批量模式**：选择 **"批量处理/拼接"**
3. **选择文件夹**：包含要拼接的所有视频片段
4. **执行**：点击 **"🚀 立即执行"**
5. **输出**：生成 `folder_joined.mp4`

> ⚠️ **注意**：拼接要求所有视频具有相同的编码格式、分辨率和帧率。

#### 场景5：提取音频制作铃声

1. **功能选择**：选择 **"🎵 提取音频 (MP3/AAC)"**
2. **参数设置**：
   - 输出格式：`mp3`
   - 比特率：`192k`
3. **先剪辑**（可选）：如需剪辑特定片段，先用 **"✂️ 精确剪辑"** 功能
4. **执行**：点击 **"🚀 立即执行"**
5. **输出**：生成 `audio.mp3`

---

## 🎨 高级功能

### 📋 任务队列管理

任务队列允许你批量添加任务，程序会自动依次执行：

1. 在 **"工具箱"** 标签添加任务到队列
2. 切换到 **"任务队列"** 标签查看待处理任务
3. 点击 **"▶️ 开始队列"** 启动批量处理
4. 可随时 **"⏸️ 暂停队列"** 或 **"🗑️ 清空队列"**

**队列功能**：
- ✅ 显示任务状态（等待中/执行中/成功/失败）
- ✅ 实时进度条
- ✅ 单个任务移除
- ✅ 失败任务自动记录

### 📜 历史记录

所有任务执行记录都会保存在历史记录中：

- **查看历史**：切换到 **"历史记录"** 标签
- **导出历史**：点击 **"💾 导出历史"** 保存为 CSV 文件
- **清空历史**：点击 **"🗑️ 清空历史"** 清除所有记录

历史记录包含：
- 任务名称、文件路径
- 执行状态（成功/失败）
- 开始时间、结束时间
- 错误信息（如有）

### 🎨 主题切换

支持深色和浅色两种主题：

1. 点击顶部 **"🎨 切换主题"** 按钮快速切换
2. 或在 **"⚙️ 设置"** 标签中选择主题
3. 设置会自动保存，下次启动自动应用

**深色主题**：适合长时间使用，保护视力  
**浅色主题**：适合明亮环境，界面清爽

---

## ⚙️ 参数说明

### 视频编码参数

#### CRF（恒定质量模式）
- **范围**：0-51（数值越小质量越高，体积越大）
- **推荐值**：
  - `18`：近无损，适合归档
  - `23`：默认值，平衡质量和体积
  - `28`：中等压缩，适合网络分享
  - `35`：高度压缩，画质明显下降

#### 编码预设（Preset）
影响编码速度和压缩效率：

| 预设 | 速度 | 压缩率 | 说明 |
|------|------|--------|------|
| ultrafast | ⚡⚡⚡⚡⚡ | ⭐ | 极快，压缩率低 |
| fast | ⚡⚡⚡⚡ | ⭐⭐ | 快速 |
| medium | ⚡⚡⚡ | ⭐⭐⭐ | 推荐，平衡 |
| slow | ⚡⚡ | ⭐⭐⭐⭐ | 较慢，压缩率高 |
| veryslow | ⚡ | ⭐⭐⭐⭐⭐ | 极慢，最高压缩 |

### 音频参数

#### 比特率
- **128k**：低质量，适合语音
- **192k**：标准质量（推荐）
- **256k**：高质量
- **320k**：极高质量

#### 音量调节
- **-20dB ~ -5dB**：降低音量
- **0dB**：不改变
- **+5dB ~ +20dB**：提高音量

---

## 🐛 常见问题

### Q1: 提示"未检测到 FFmpeg"怎么办？

**A**: FFmpeg 未正确安装或未添加到环境变量。

**解决方法**：
1. 确认 FFmpeg 已下载并解压
2. 将 FFmpeg 的 `bin` 目录添加到系统 PATH
3. 重启终端/命令提示符
4. 运行 `ffmpeg -version` 验证

**Windows 添加环境变量**：
1. 右键"此电脑" → "属性" → "高级系统设置"
2. "环境变量" → 编辑 "Path"
3. 添加 FFmpeg 的 bin 目录路径（如 `C:\ffmpeg\bin`）
4. 重启程序

### Q2: 任务失败，提示"编码错误"？

**A**: 可能是输入文件损坏或格式不支持。

**解决方法**：
1. 用播放器测试源文件是否正常
2. 尝试使用 **"格式转换"** 功能转换为标准格式
3. 检查日志区域的详细错误信息

### Q3: 字幕烧录后中文乱码？

**A**: 字幕文件编码问题。

**解决方法**：
1. 将字幕文件转换为 UTF-8 编码
2. 使用记事本打开字幕 → "另存为" → 编码选择 "UTF-8"
3. 或使用 **软字幕封装** 代替烧录（推荐）

### Q4: 批量处理时部分文件失败？

**A**: 文件格式不一致或已处理过的文件。

**解决方法**：
1. 程序会自动跳过文件名包含 `_out` 或 `_joined` 的文件
2. 检查历史记录查看失败原因
3. 确保批量文件格式统一

### Q5: 视频压缩后体积变大了？

**A**: 源视频已经是高度压缩格式。

**解决方法**：
1. 检查源视频编码（右键 → 属性 → 详细信息）
2. 如果已是 H.264/H.265 高压缩格式，无需再压缩
3. 尝试降低 CRF 值（增加 28 → 30）

### Q6: 程序卡住不动？

**A**: 可能是处理大文件或复杂操作。

**解决方法**：
1. 查看日志区域，FFmpeg 仍在运行
2. 某些操作（如防抖、倒放）耗时较长，请耐心等待
3. 如确实卡死，点击 **"⏹️ 停止"** 终止任务

### Q7: 如何同时处理视频和音频？

**A**: 使用滤镜功能可以叠加效果。

**示例**：先剪辑 → 再压缩 → 最后调整音量
```
方法1: 分步执行（推荐新手）
  剪辑 → 输出1 → 压缩 → 输出2 → 音量调节 → 最终输出

方法2: 添加到队列批量处理
  任务1: 剪辑
  任务2: 压缩
  任务3: 音量调节
  点击"开始队列"自动执行
```

### Q8: 输出文件保存在哪里？

**A**: 默认保存在源文件同目录，文件名添加后缀：

- `video_merged.mkv` - 字幕封装
- `video_compressed.mp4` - 压缩
- `video_trimmed.mp4` - 剪辑
- `video.mp3` - 提取音频

---

## 🔧 故障排除

### 日志分析

当任务失败时，请查看 **"📝 系统日志"** 区域的详细信息：

```
[10:30:15] === 开始任务: 软字幕封装 ===
[10:30:15] 命令: ffmpeg -i video.mp4 -i subtitle.srt ...
[10:30:20] error: Invalid data found when processing input
[10:30:20] ✗ 任务失败 (退出码: 1)
```

**常见错误信息**：

| 错误信息 | 原因 | 解决方法 |
|---------|------|---------|
| `Invalid data found` | 文件损坏 | 重新下载或转换文件 |
| `No such file or directory` | 路径错误 | 检查文件路径，避免中文路径 |
| `Codec not supported` | 编码不支持 | 更换编码器或转换格式 |
| `Permission denied` | 权限不足 | 以管理员身份运行 |
| `Unknown encoder` | FFmpeg 缺少编码库 | 下载完整版 FFmpeg |

### 性能优化

**处理大文件时**：
- 使用 **"fast"** 或 **"veryfast"** 预设加速
- 关闭其他占用 CPU 的程序
- 将文件保存到 SSD 硬盘

**批量处理时**：
- 使用任务队列避免手动操作
- 夜间挂机处理大量文件
- 定期清理历史记录和临时文件

---

## 📊 性能参考

不同操作的大致处理速度（以 1080p 10分钟视频为例）：

| 操作 | 耗时 | 说明 |
|------|------|------|
| 软字幕封装 | 5-10 秒 | 极快，无需重编码 |
| 格式转换（copy） | 10-20 秒 | 快速，容器转换 |
| 视频剪辑 | 1-2 分钟 | 中等，需重编码 |
| 视频压缩 | 3-8 分钟 | 较慢，取决于预设 |
| 字幕烧录 | 4-10 分钟 | 较慢，需重编码 |
| GIF 导出 | 2-5 分钟 | 中等，取决于帧率 |
| 视频防抖 | 10-20 分钟 | 很慢，需两次处理 |
| 视频倒放 | 15-30 分钟 | 很慢，需全部解码 |

> 💡 **提示**：实际速度取决于 CPU 性能、视频分辨率和编码参数。

---

## 🆕 更新日志

### v3.0 (2024-12-12) - 重大更新

#### 🎉 新特性
- ✨ 完全使用 **PyQt5** 重写，界面更现代美观
- ✨ 新增 **实时进度显示**，解析 FFmpeg 输出显示真实进度
- ✨ 新增 **任务队列管理**，支持批量任务自动排队执行
- ✨ 新增 **历史记录功能**，完整记录所有任务执行情况
- ✨ 新增 **拖拽文件支持**，直接拖拽文件到输入框
- ✨ 新增 **智能匹配功能**，自动查找同名字幕/音频文件
- ✨ 新增 **深色/浅色主题**，支持一键切换
- ✨ 新增 **设置保存功能**，记住用户偏好

#### 🚀 功能增强
- 🔧 新增 **视频倒放** 功能
- 🔧 新增 **视频降噪** 功能（3档强度）
- 🔧 新增 **视频防抖** 功能
- 🔧 优化 **变速播放**，支持 0.25x-4x 完整范围
- 🔧 增强 **水印功能**，支持自定义位置和字体大小
- 🔧 改进 **压缩功能**，支持 H.265 编码
- 🔧 完善 **格式转换**，支持更多视频格式

#### 🎨 界面优化
- 💎 采用现代化分栏布局，日志区域可调整大小
- 💎 增加任务详细描述和参数提示
- 💎 优化分组和视觉层次
- 💎 实时状态栏显示处理进度
- 💎 表格化显示队列和历史记录
- 💎 更友好的错误提示和操作反馈

#### 🐛 Bug 修复
- 🔨 修复线程安全问题，避免界面卡死
- 🔨 改进错误处理机制，提供详细错误信息
- 🔨 优化 FFmpeg 命令生成逻辑
- 🔨 修复文件路径特殊字符问题
- 🔨 改进音频变速超范围处理
- 🔨 修复批量处理时的文件跳过逻辑

### v2.0 (之前版本)
- 基于 Tkinter 的初始图形界面版本
- 支持 15+ 基础视频处理功能

### v1.0 (早期版本)
- 命令行脚本版本

---

## 🤝 贡献指南

欢迎贡献代码、报告 Bug 或提出新功能建议！

### 报告问题

遇到问题时，请提供以下信息：
1. 操作系统版本
2. Python 版本
3. FFmpeg 版本
4. 详细的错误日志
5. 复现步骤

### 功能建议

如有新功能建议，请说明：
1. 功能描述
2. 使用场景
3. 期望效果

---

## 📄 许可证

本项目采用 **MIT License** 开源协议。

```
MIT License

Copyright (c) 2024 SubMux Omni Pro

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

---

## 🙏 致谢

- **FFmpeg** - 强大的多媒体处理框架
- **PyQt5** - 优秀的 Python GUI 框架
- 所有贡献者和使用者

---

## 📞 联系方式

- **问题反馈**：通过 GitHub Issues 提交
- **功能建议**：通过 GitHub Discussions 讨论

---

## ⭐ Star History

如果这个项目对你有帮助，请给一个 ⭐ Star 支持一下！

---

<div align="center">

**Made with ❤️ by SubMux Omni Pro Team**

[⬆ 回到顶部](#submux-omni-pro-v30)

</div>